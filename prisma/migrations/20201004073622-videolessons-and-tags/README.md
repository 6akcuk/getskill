# Migration `20201004073622-videolessons-and-tags`

This migration has been generated by Denis at 10/4/2020, 12:36:22 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `getskill-mvp`.`VideoLesson` (
`id` int NOT NULL  AUTO_INCREMENT,
`userId` int NOT NULL ,
`uid` varchar(191) NOT NULL ,
`name` varchar(191) NOT NULL ,
`description` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `getskill-mvp`.`Tag` (
`id` int NOT NULL  AUTO_INCREMENT,
`name` varchar(191) NOT NULL ,
`type` ENUM('SKILL') NOT NULL ,
`videoLessonId` int  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `getskill-mvp`.`ServicesToTags` (
`tagId` int NOT NULL ,
`serviceId` int NOT NULL ,
`serviceName` varchar(191) NOT NULL ,
`videoLessonId` int NOT NULL ,
PRIMARY KEY (`tagId`,`serviceId`,`serviceName`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `getskill-mvp`.`VideoLesson` ADD FOREIGN KEY (`userId`) REFERENCES `getskill-mvp`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `getskill-mvp`.`Tag` ADD FOREIGN KEY (`videoLessonId`) REFERENCES `getskill-mvp`.`VideoLesson`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `getskill-mvp`.`ServicesToTags` ADD FOREIGN KEY (`tagId`) REFERENCES `getskill-mvp`.`Tag`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `getskill-mvp`.`ServicesToTags` ADD FOREIGN KEY (`videoLessonId`) REFERENCES `getskill-mvp`.`VideoLesson`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200816232037-make-contacts-nullable..20201004073622-videolessons-and-tags
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -45,4 +45,36 @@
   contacts Json?
   user User @relation(fields: [userId], references: [id])
   userId Int
 }
+
+model VideoLesson {
+  id Int @default(autoincrement()) @id
+  userId Int
+  uid String
+  name String
+  description String?
+  tags Tag[]
+  user User @relation(fields: [userId], references: [id])
+}
+
+enum TagType {
+  SKILL
+}
+
+model Tag {
+  id Int @default(autoincrement()) @id
+  name String
+  type TagType
+}
+
+model ServicesToTags {
+  tagId Int
+  tag Tag @relation(fields: [tagId], references: [id])
+  serviceId Int
+  serviceName String
+  
+  videoLessonId Int
+  videoLesson VideoLesson @relation(fields: [videoLessonId], references: [id])
+
+  @@id([tagId, serviceId, serviceName])
+}
```


